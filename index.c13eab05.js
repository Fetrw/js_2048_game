const t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e=new class{constructor(e){this.initialState=e||t,this.state=this.copyState(this.initialState),this.score=0,this.status="idle"}copyState(t){return t.map(t=>t.slice())}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}start(){this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.state=this.copyState(this.initialState),this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.state[e],a=this.slide(s);this.arraysEqual(s,a)||(this.state[e]=a,t=!0)}t&&(this.addRandomTile(),this.checkGameStatus())}moveRight(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.state[e],a=s.slice().reverse(),r=this.slide(a).reverse();this.arraysEqual(s,r)||(this.state[e]=r,t=!0)}t&&(this.addRandomTile(),this.checkGameStatus())}moveUp(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.state.map(t=>t[e]),a=this.slide(s);if(!this.arraysEqual(s,a)){for(let t=0;t<4;t++)this.state[t][e]=a[t];t=!0}}t&&(this.addRandomTile(),this.checkGameStatus())}moveDown(){if("playing"!==this.status)return;let t=!1;for(let e=0;e<4;e++){let s=this.state.map(t=>t[e]),a=s.slice().reverse(),r=this.slide(a).reverse();if(!this.arraysEqual(s,r)){for(let t=0;t<4;t++)this.state[t][e]=r[t];t=!0}}t&&(this.addRandomTile(),this.checkGameStatus())}slide(t){let e=t.filter(t=>0!==t),s=[];for(let t=0;t<e.length;t++)e[t]===e[t+1]?(s.push(2*e[t]),this.score+=2*e[t],t++):s.push(e[t]);for(;s.length<4;)s.push(0);return s}addRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push({row:e,col:s});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:s,col:a}=t[e];this.state[s][a]=.9>Math.random()?2:4}}arraysEqual(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}checkGameStatus(){if(this.state.flat().includes(2048)){this.status="win";return}let t=this.state.flat().includes(0),e=this.canMerge();t||e||(this.status="lose")}canMerge(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(0!==s&&(e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e]))return!0}return!1}},s=document.querySelector(".game-field"),a=document.querySelector(".game-score"),r=document.querySelector(".start"),i=document.querySelector(".message-container"),l={lose:document.querySelector(".message-lose"),win:document.querySelector(".message-win"),start:document.querySelector(".message-start")};function o(){let t=e.getState(),r=e.getScore(),o=e.getStatus();a.textContent=r,s.querySelectorAll(".field-row").forEach((e,s)=>{e.querySelectorAll(".field-cell").forEach((e,a)=>{e.textContent=t[s][a]||"",e.className=`field-cell ${t[s][a]?`field-cell--${t[s][a]}`:""}`})}),i.querySelectorAll(".message").forEach(t=>t.classList.add("hidden")),"win"===o?l.win.classList.remove("hidden"):"lose"===o?l.lose.classList.remove("hidden"):"playing"===o?l.start.classList.add("hidden"):l.start.classList.remove("hidden")}r.addEventListener("click",()=>{"idle"===e.getStatus()?(e.start(),r.textContent="Restart",r.classList.remove("start"),r.classList.add("restart")):(e.restart(),r.textContent="Start",r.classList.remove("restart"),r.classList.add("start")),o()}),document.addEventListener("keydown",function(t){if("playing"===e.getStatus()){switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown();break;default:return}o()}}),o();
//# sourceMappingURL=index.c13eab05.js.map
